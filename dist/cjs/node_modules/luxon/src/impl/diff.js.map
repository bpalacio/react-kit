{"version":3,"file":"diff.js","sources":["../../../../../../node_modules/luxon/src/impl/diff.js"],"sourcesContent":["import Duration from \"../duration.js\";\n\nfunction dayDiff(earlier, later) {\n  const utcDayStart = (dt) => dt.toUTC(0, { keepLocalTime: true }).startOf(\"day\").valueOf(),\n    ms = utcDayStart(later) - utcDayStart(earlier);\n  return Math.floor(Duration.fromMillis(ms).as(\"days\"));\n}\n\nfunction highOrderDiffs(cursor, later, units) {\n  const differs = [\n    [\"years\", (a, b) => b.year - a.year],\n    [\"quarters\", (a, b) => b.quarter - a.quarter + (b.year - a.year) * 4],\n    [\"months\", (a, b) => b.month - a.month + (b.year - a.year) * 12],\n    [\n      \"weeks\",\n      (a, b) => {\n        const days = dayDiff(a, b);\n        return (days - (days % 7)) / 7;\n      },\n    ],\n    [\"days\", dayDiff],\n  ];\n\n  const results = {};\n  const earlier = cursor;\n  let lowestOrder, highWater;\n\n  for (const [unit, differ] of differs) {\n    if (units.indexOf(unit) >= 0) {\n      lowestOrder = unit;\n\n      results[unit] = differ(cursor, later);\n      highWater = earlier.plus(results);\n\n      if (highWater > later) {\n        results[unit]--;\n        cursor = earlier.plus(results);\n      } else {\n        cursor = highWater;\n      }\n    }\n  }\n\n  return [cursor, results, highWater, lowestOrder];\n}\n\nexport default function (earlier, later, units, opts) {\n  let [cursor, results, highWater, lowestOrder] = highOrderDiffs(earlier, later, units);\n\n  const remainingMillis = later - cursor;\n\n  const lowerOrderUnits = units.filter(\n    (u) => [\"hours\", \"minutes\", \"seconds\", \"milliseconds\"].indexOf(u) >= 0\n  );\n\n  if (lowerOrderUnits.length === 0) {\n    if (highWater < later) {\n      highWater = cursor.plus({ [lowestOrder]: 1 });\n    }\n\n    if (highWater !== cursor) {\n      results[lowestOrder] = (results[lowestOrder] || 0) + remainingMillis / (highWater - cursor);\n    }\n  }\n\n  const duration = Duration.fromObject(results, opts);\n\n  if (lowerOrderUnits.length > 0) {\n    return Duration.fromMillis(remainingMillis, opts)\n      .shiftTo(...lowerOrderUnits)\n      .plus(duration);\n  } else {\n    return duration;\n  }\n}\n"],"names":["dayDiff","earlier","later","utcDayStart","dt","toUTC","keepLocalTime","startOf","valueOf","ms","Math","floor","Duration","fromMillis","as","units","opts","cursor","results","highWater","lowestOrder","differs","a","b","year","quarter","month","days","unit","differ","indexOf","plus","highOrderDiffs","remainingMillis","lowerOrderUnits","filter","u","length","duration","default","fromObject","shiftTo"],"mappings":"6CAEA,SAASA,EAAQC,EAASC,GACxB,MAAMC,EAAeC,GAAOA,EAAGC,MAAM,EAAG,CAAEC,eAAe,IAAQC,QAAQ,OAAOC,UAC9EC,EAAKN,EAAYD,GAASC,EAAYF,GACxC,OAAOS,KAAKC,MAAMC,UAASC,WAAWJ,GAAIK,GAAG,QAC/C,gBAwCe,SAAUb,EAASC,EAAOa,EAAOC,GAC9C,IAAKC,EAAQC,EAASC,EAAWC,GAvCnC,SAAwBH,EAAQf,EAAOa,GACrC,MAAMM,EAAU,CACd,CAAC,QAAS,CAACC,EAAGC,IAAMA,EAAEC,KAAOF,EAAEE,MAC/B,CAAC,WAAY,CAACF,EAAGC,IAAMA,EAAEE,QAAUH,EAAEG,QAA8B,GAAnBF,EAAEC,KAAOF,EAAEE,OAC3D,CAAC,SAAU,CAACF,EAAGC,IAAMA,EAAEG,MAAQJ,EAAEI,MAA4B,IAAnBH,EAAEC,KAAOF,EAAEE,OACrD,CACE,QACA,CAACF,EAAGC,KACF,MAAMI,EAAO3B,EAAQsB,EAAGC,GACxB,OAAQI,EAAQA,EAAO,GAAM,CAAC,GAGlC,CAAC,OAAQ3B,IAGLkB,EAAU,CAAA,EACVjB,EAAUgB,EAChB,IAAIG,EAAaD,EAEjB,IAAK,MAAOS,EAAMC,KAAWR,EACvBN,EAAMe,QAAQF,IAAS,IACzBR,EAAcQ,EAEdV,EAAQU,GAAQC,EAAOZ,EAAQf,GAC/BiB,EAAYlB,EAAQ8B,KAAKb,GAErBC,EAAYjB,GACdgB,EAAQU,KACRX,EAAShB,EAAQ8B,KAAKb,IAEtBD,EAASE,GAKf,MAAO,CAACF,EAAQC,EAASC,EAAWC,EACtC,CAGkDY,CAAe/B,EAASC,EAAOa,GAE/E,MAAMkB,EAAkB/B,EAAQe,EAE1BiB,EAAkBnB,EAAMoB,QAC3BC,GAAM,CAAC,QAAS,UAAW,UAAW,gBAAgBN,QAAQM,IAAM,IAGxC,IAA3BF,EAAgBG,SACdlB,EAAYjB,IACdiB,EAAYF,EAAOc,KAAK,CAAEX,CAACA,GAAc,KAGvCD,IAAcF,IAChBC,EAAQE,IAAgBF,EAAQE,IAAgB,GAAKa,GAAmBd,EAAYF,KAIxF,MAAMqB,EAAW1B,EAAQ2B,QAACC,WAAWtB,EAASF,GAE9C,OAAIkB,EAAgBG,OAAS,EACpBzB,UAASC,WAAWoB,EAAiBjB,GACzCyB,WAAWP,GACXH,KAAKO,GAEDA,CAEX"}