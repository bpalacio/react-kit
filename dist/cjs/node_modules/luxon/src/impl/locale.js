"use strict";var t=require("./util.js"),e=require("./english.js"),s=require("../settings.js"),r=require("../datetime.js"),n=require("../zones/IANAZone.js");let i={};let a={};function o(t,e={}){const s=JSON.stringify([t,e]);let r=a[s];return r||(r=new Intl.DateTimeFormat(t,e),a[s]=r),r}let l={};let u={};let h=null;function c(t,e,s,r,n){const i=t.listingMode(s);return"error"===i?null:"en"===i?r(e):n(e)}class m{constructor(t,e,s){this.padTo=s.padTo||0,this.floor=s.floor||!1;const{padTo:r,floor:n,...i}=s;if(!e||Object.keys(i).length>0){const e={useGrouping:!1,...s};s.padTo>0&&(e.minimumIntegerDigits=s.padTo),this.inf=function(t,e={}){const s=JSON.stringify([t,e]);let r=l[s];return r||(r=new Intl.NumberFormat(t,e),l[s]=r),r}(t,e)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}{const s=this.floor?Math.floor(e):t.roundTo(e,3);return t.padStart(s,this.padTo)}}}class d{constructor(t,e,s){let i;if(this.opts=s,t.zone.isUniversal){const e=t.offset/60*-1,a=e>=0?`Etc/GMT+${e}`:`Etc/GMT${e}`;0!==t.offset&&n.create(a).valid?(i=a,this.dt=t):(i="UTC",s.timeZoneName?this.dt=t:this.dt=0===t.offset?t:r.default.fromMillis(t.ts+60*t.offset*1e3))}else"system"===t.zone.type?this.dt=t:(this.dt=t,i=t.zone.name);const a={...this.opts};a.timeZone=a.timeZone||i,this.dtf=o(e,a)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class f{constructor(e,s,r){this.opts={style:"long",...r},!s&&t.hasRelative()&&(this.rtf=function(t,e={}){const{base:s,...r}=e,n=JSON.stringify([t,r]);let i=u[n];return i||(i=new Intl.RelativeTimeFormat(t,e),u[n]=i),i}(e,r))}format(t,s){return this.rtf?this.rtf.format(t,s):e.formatRelativeTime(s,t,this.opts.numeric,"long"!==this.opts.style)}formatToParts(t,e){return this.rtf?this.rtf.formatToParts(t,e):[]}}class p{static fromOpts(t){return p.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,e,r,n=!1){const i=t||s.defaultLocale,a=i||(n?"en-US":h||(h=(new Intl.DateTimeFormat).resolvedOptions().locale,h)),o=e||s.defaultNumberingSystem,l=r||s.defaultOutputCalendar;return new p(a,o,l,i)}static resetCache(){h=null,a={},l={},u={}}static fromObject({locale:t,numberingSystem:e,outputCalendar:s}={}){return p.create(t,e,s)}constructor(t,e,s,r){const[n,i,a]=function(t){const e=t.indexOf("-x-");-1!==e&&(t=t.substring(0,e));const s=t.indexOf("-u-");if(-1===s)return[t];{let e,r;try{e=o(t).resolvedOptions(),r=t}catch(n){const i=t.substring(0,s);e=o(i).resolvedOptions(),r=i}const{numberingSystem:n,calendar:i}=e;return[r,n,i]}}(t);this.locale=n,this.numberingSystem=e||i||null,this.outputCalendar=s||a||null,this.intl=function(t,e,s){return s||e?(t.includes("-u-")||(t+="-u"),s&&(t+=`-ca-${s}`),e&&(t+=`-nu-${e}`),t):t}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){var t;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(t=this).numberingSystem||"latn"===t.numberingSystem)&&("latn"===t.numberingSystem||!t.locale||t.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),e=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return t&&e?"en":"intl"}clone(t){return t&&0!==Object.getOwnPropertyNames(t).length?p.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1):this}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,s=!1,n=!0){return c(this,t,n,e.months,(()=>{const e=s?{month:t,day:"numeric"}:{month:t},n=s?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=function(t){const e=[];for(let s=1;s<=12;s++){const n=r.default.utc(2016,s,1);e.push(t(n))}return e}((t=>this.extract(t,e,"month")))),this.monthsCache[n][t]}))}weekdays(t,s=!1,n=!0){return c(this,t,n,e.weekdays,(()=>{const e=s?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=s?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=function(t){const e=[];for(let s=1;s<=7;s++){const n=r.default.utc(2016,11,13+s);e.push(t(n))}return e}((t=>this.extract(t,e,"weekday")))),this.weekdaysCache[n][t]}))}meridiems(t=!0){return c(this,void 0,t,(()=>e.meridiems),(()=>{if(!this.meridiemCache){const t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[r.default.utc(2016,11,13,9),r.default.utc(2016,11,13,19)].map((e=>this.extract(e,t,"dayperiod")))}return this.meridiemCache}))}eras(t,s=!0){return c(this,t,s,e.eras,(()=>{const e={era:t};return this.eraCache[t]||(this.eraCache[t]=[r.default.utc(-40,1,1),r.default.utc(2017,1,1)].map((t=>this.extract(t,e,"era")))),this.eraCache[t]}))}extract(t,e,s){const r=this.dtFormatter(t,e).formatToParts().find((t=>t.type.toLowerCase()===s));return r?r.value:null}numberFormatter(t={}){return new m(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,e={}){return new d(t,this.intl,e)}relFormatter(t={}){return new f(this.intl,this.isEnglish(),t)}listFormatter(t={}){return function(t,e={}){const s=JSON.stringify([t,e]);let r=i[s];return r||(r=new Intl.ListFormat(t,e),i[s]=r),r}(this.intl,t)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}module.exports=p;
//# sourceMappingURL=locale.js.map
