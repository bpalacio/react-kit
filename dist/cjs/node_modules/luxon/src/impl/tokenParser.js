"use strict";var e=require("./util.js"),r=require("./formatter.js"),n=require("../zones/fixedOffsetZone.js"),t=require("../zones/IANAZone.js"),s=require("../datetime.js"),a=require("./digits.js"),i=require("../errors.js");const c="missing Intl.DateTimeFormat.formatToParts support";function u(e,r=(e=>e)){return{regex:e,deser:([e])=>r(a.parseDigits(e))}}const o=`[ ${String.fromCharCode(160)}]`,d=new RegExp(o,"g");function l(e){return e.replace(/\./g,"\\.?").replace(d,o)}function g(e){return e.replace(/\./g,"").replace(d," ").toLowerCase()}function f(e,r){return null===e?null:{regex:RegExp(e.map(l).join("|")),deser:([n])=>e.findIndex((e=>g(n)===g(e)))+r}}function m(r,n){return{regex:r,deser:([,r,n])=>e.signedOffset(r,n),groups:n}}function y(e){return{regex:e,deser:([e])=>e}}const p={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let h=null;function x(e,n){return Array.prototype.concat(...e.map((e=>function(e,n){if(e.literal)return e;const t=M(r.macroTokenToFormatOpts(e.val),n);return null==t||t.includes(void 0)?e:t}(e,n))))}function k(s,o,d){const l=x(r.parseFormat(d),s),g=l.map((r=>function(r,n){const t=a.digitRegex(n),s=a.digitRegex(n,"{2}"),i=a.digitRegex(n,"{3}"),o=a.digitRegex(n,"{4}"),d=a.digitRegex(n,"{6}"),l=a.digitRegex(n,"{1,2}"),g=a.digitRegex(n,"{1,3}"),p=a.digitRegex(n,"{1,6}"),h=a.digitRegex(n,"{1,9}"),x=a.digitRegex(n,"{2,4}"),k=a.digitRegex(n,"{4,6}"),M=e=>{return{regex:RegExp((r=e.val,r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([e])=>e,literal:!0};var r},E=(a=>{if(r.literal)return M(a);switch(a.val){case"G":return f(n.eras("short",!1),0);case"GG":return f(n.eras("long",!1),0);case"y":return u(p);case"yy":case"kk":return u(x,e.untruncateYear);case"yyyy":case"kkkk":return u(o);case"yyyyy":return u(k);case"yyyyyy":return u(d);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return u(l);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return u(s);case"MMM":return f(n.months("short",!0,!1),1);case"MMMM":return f(n.months("long",!0,!1),1);case"LLL":return f(n.months("short",!1,!1),1);case"LLLL":return f(n.months("long",!1,!1),1);case"o":case"S":return u(g);case"ooo":case"SSS":return u(i);case"u":return y(h);case"uu":return y(l);case"uuu":case"E":case"c":return u(t);case"a":return f(n.meridiems(),0);case"EEE":return f(n.weekdays("short",!1,!1),1);case"EEEE":return f(n.weekdays("long",!1,!1),1);case"ccc":return f(n.weekdays("short",!0,!1),1);case"cccc":return f(n.weekdays("long",!0,!1),1);case"Z":case"ZZ":return m(new RegExp(`([+-]${l.source})(?::(${s.source}))?`),2);case"ZZZ":return m(new RegExp(`([+-]${l.source})(${s.source})?`),2);case"z":return y(/[a-z_+-/]{1,256}?/i);default:return M(a)}})(r)||{invalidReason:c};return E.token=r,E}(r,s))),p=g.find((e=>e.invalidReason));if(p)return{input:o,tokens:l,invalidReason:p.invalidReason};{const[r,s]=function(e){return[`^${e.map((e=>e.regex)).reduce(((e,r)=>`${e}(${r.source})`),"")}$`,e]}(g),a=RegExp(r,"i"),[c,u]=function(r,n,t){const s=r.match(n);if(s){const r={};let n=1;for(const a in t)if(e.hasOwnProperty(t,a)){const e=t[a],i=e.groups?e.groups+1:1;!e.literal&&e.token&&(r[e.token.val[0]]=e.deser(s.slice(n,n+i))),n+=i}return[s,r]}return[s,{}]}(o,a,s),[d,f,m]=u?function(r){let s,a=null;return e.isUndefined(r.z)||(a=t.create(r.z)),e.isUndefined(r.Z)||(a||(a=new n(r.Z)),s=r.Z),e.isUndefined(r.q)||(r.M=3*(r.q-1)+1),e.isUndefined(r.h)||(r.h<12&&1===r.a?r.h+=12:12===r.h&&0===r.a&&(r.h=0)),0===r.G&&r.y&&(r.y=-r.y),e.isUndefined(r.u)||(r.S=e.parseMillis(r.u)),[Object.keys(r).reduce(((e,n)=>{const t=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return t&&(e[t]=r[n]),e}),{}),a,s]}(u):[null,null,void 0];if(e.hasOwnProperty(u,"a")&&e.hasOwnProperty(u,"H"))throw new i.ConflictingSpecificationError("Can't include meridiem when specifying 24-hour format");return{input:o,tokens:l,regex:a,rawMatches:c,matches:u,result:d,zone:f,specificOffset:m}}}function M(e,n){if(!e)return null;return r.create(n,e).formatDateTimeParts((h||(h=s.default.fromMillis(1555555555555)),h)).map((r=>function(e,r){const{type:n,value:t}=e;if("literal"===n)return{literal:!0,val:t};const s=r[n];let a=p[n];return"object"==typeof a&&(a=a[s]),a?{literal:!1,val:a}:void 0}(r,e)))}exports.expandMacroTokens=x,exports.explainFromTokens=k,exports.formatOptsToTokens=M,exports.parseFromTokens=function(e,r,n){const{result:t,zone:s,specificOffset:a,invalidReason:i}=k(e,r,n);return[t,s,a,i]};
//# sourceMappingURL=tokenParser.js.map
