"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./duration.js"),t=require("./interval.js"),i=require("./settings.js"),n=require("./info.js"),r=require("./impl/formatter.js"),s=require("./zones/fixedOffsetZone.js"),a=require("./impl/locale.js"),o=require("./impl/util.js"),l=require("./impl/zoneUtil.js"),u=require("./impl/diff.js"),d=require("./impl/regexParser.js"),c=require("./impl/tokenParser.js"),h=require("./impl/conversions.js"),m=require("./impl/formats.js"),f=require("./errors.js"),T=require("./impl/invalid.js");const y="Invalid DateTime",g=864e13;function E(e){return new T("unsupported zone",`the zone "${e.name}" is not supported`)}function S(e){return null===e.weekData&&(e.weekData=h.gregorianToWeek(e.c)),e.weekData}function w(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new C({...i,...t,old:i})}function O(e,t,i){let n=e-60*t*1e3;const r=i.offset(n);if(t===r)return[n,t];n-=60*(r-t)*1e3;const s=i.offset(n);return r===s?[n,r]:[e-60*Math.min(r,s)*1e3,Math.max(r,s)]}function p(e,t){const i=new Date(e+=60*t*1e3);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function D(e,t,i){return O(o.objToLocalTS(e),t,i)}function I(t,i){const n=t.o,r=t.c.year+Math.trunc(i.years),s=t.c.month+Math.trunc(i.months)+3*Math.trunc(i.quarters),a={...t.c,year:r,month:s,day:Math.min(t.c.day,o.daysInMonth(r,s))+Math.trunc(i.days)+7*Math.trunc(i.weeks)},l=e.default.fromObject({years:i.years-Math.trunc(i.years),quarters:i.quarters-Math.trunc(i.quarters),months:i.months-Math.trunc(i.months),weeks:i.weeks-Math.trunc(i.weeks),days:i.days-Math.trunc(i.days),hours:i.hours,minutes:i.minutes,seconds:i.seconds,milliseconds:i.milliseconds}).as("milliseconds"),u=o.objToLocalTS(a);let[d,c]=O(u,n,t.zone);return 0!==l&&(d+=l,c=t.zone.offset(d)),{ts:d,o:c}}function _(e,t,i,n,r,s){const{setZone:a,zone:o}=i;if(e&&0!==Object.keys(e).length){const n=t||o,r=C.fromObject(e,{...i,zone:n,specificOffset:s});return a?r:r.setZone(o)}return C.invalid(new T("unparsable",`the input "${r}" can't be parsed as ${n}`))}function N(e,t,i=!0){return e.isValid?r.create(a.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function k(e,t){const i=e.c.year>9999||e.c.year<0;let n="";return i&&e.c.year>=0&&(n+="+"),n+=o.padStart(e.c.year,i?6:4),t?(n+="-",n+=o.padStart(e.c.month),n+="-",n+=o.padStart(e.c.day)):(n+=o.padStart(e.c.month),n+=o.padStart(e.c.day)),n}function M(e,t,i,n,r,s){let a=o.padStart(e.c.hour);return t?(a+=":",a+=o.padStart(e.c.minute),0===e.c.second&&i||(a+=":")):a+=o.padStart(e.c.minute),0===e.c.second&&i||(a+=o.padStart(e.c.second),0===e.c.millisecond&&n||(a+=".",a+=o.padStart(e.c.millisecond,3))),r&&(e.isOffsetFixed&&0===e.offset&&!s?a+="Z":e.o<0?(a+="-",a+=o.padStart(Math.trunc(-e.o/60)),a+=":",a+=o.padStart(Math.trunc(-e.o%60))):(a+="+",a+=o.padStart(Math.trunc(e.o/60)),a+=":",a+=o.padStart(Math.trunc(e.o%60)))),s&&(a+="["+e.zone.ianaName+"]"),a}const b={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},v={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},V={ordinal:1,hour:0,minute:0,second:0,millisecond:0},z=["year","month","day","hour","minute","second","millisecond"],L=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],H=["year","ordinal","hour","minute","second","millisecond"];function U(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new f.InvalidUnitError(e);return t}function j(e,t){const n=l.normalizeZone(t.zone,i.defaultZone),r=a.fromObject(t),s=i.now();let u,d;if(o.isUndefined(e.year))u=s;else{for(const t of z)o.isUndefined(e[t])&&(e[t]=b[t]);const t=h.hasInvalidGregorianData(e)||h.hasInvalidTimeData(e);if(t)return C.invalid(t);const i=n.offset(s);[u,d]=D(e,i,n)}return new C({ts:u,zone:n,loc:r,o:d})}function A(e,t,i){const n=!!o.isUndefined(i.round)||i.round,r=(e,r)=>{e=o.roundTo(e,n||i.calendary?0:2,!0);return t.loc.clone(i).relFormatter(i).format(e,r)},s=n=>i.calendary?t.hasSame(e,n)?0:t.startOf(n).diff(e.startOf(n),n).get(n):t.diff(e,n).get(n);if(i.unit)return r(s(i.unit),i.unit);for(const e of i.units){const t=s(e);if(Math.abs(t)>=1)return r(t,e)}return r(e>t?-0:0,i.units[i.units.length-1])}function F(e){let t,i={};return e.length>0&&"object"==typeof e[e.length-1]?(i=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[i,t]}class C{constructor(e){const t=e.zone||i.defaultZone;let n=e.invalid||(Number.isNaN(e.ts)?new T("invalid input"):null)||(t.isValid?null:E(t));this.ts=o.isUndefined(e.ts)?i.now():e.ts;let r=null,s=null;if(!n){if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,s]=[e.old.c,e.old.o];else{const e=t.offset(this.ts);r=p(this.ts,e),n=Number.isNaN(r.year)?new T("invalid input"):null,r=n?null:r,s=n?null:e}}this._zone=t,this.loc=e.loc||a.create(),this.invalid=n,this.weekData=null,this.c=r,this.o=s,this.isLuxonDateTime=!0}static now(){return new C({})}static local(){const[e,t]=F(arguments),[i,n,r,s,a,o,l]=t;return j({year:i,month:n,day:r,hour:s,minute:a,second:o,millisecond:l},e)}static utc(){const[e,t]=F(arguments),[i,n,r,a,o,l,u]=t;return e.zone=s.utcInstance,j({year:i,month:n,day:r,hour:a,minute:o,second:l,millisecond:u},e)}static fromJSDate(e,t={}){const n=o.isDate(e)?e.valueOf():NaN;if(Number.isNaN(n))return C.invalid("invalid input");const r=l.normalizeZone(t.zone,i.defaultZone);return r.isValid?new C({ts:n,zone:r,loc:a.fromObject(t)}):C.invalid(E(r))}static fromMillis(e,t={}){if(o.isNumber(e))return e<-g||e>g?C.invalid("Timestamp out of range"):new C({ts:e,zone:l.normalizeZone(t.zone,i.defaultZone),loc:a.fromObject(t)});throw new f.InvalidArgumentError(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(o.isNumber(e))return new C({ts:1e3*e,zone:l.normalizeZone(t.zone,i.defaultZone),loc:a.fromObject(t)});throw new f.InvalidArgumentError("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const n=l.normalizeZone(t.zone,i.defaultZone);if(!n.isValid)return C.invalid(E(n));const r=i.now(),s=o.isUndefined(t.specificOffset)?n.offset(r):t.specificOffset,u=o.normalizeObject(e,U),d=!o.isUndefined(u.ordinal),c=!o.isUndefined(u.year),m=!o.isUndefined(u.month)||!o.isUndefined(u.day),T=c||m,y=u.weekYear||u.weekNumber,g=a.fromObject(t);if((T||d)&&y)throw new f.ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&d)throw new f.ConflictingSpecificationError("Can't mix ordinal dates with month/day");const S=y||u.weekday&&!T;let w,O,I=p(r,s);S?(w=L,O=v,I=h.gregorianToWeek(I)):d?(w=H,O=V,I=h.gregorianToOrdinal(I)):(w=z,O=b);let _=!1;for(const e of w){const t=u[e];o.isUndefined(t)?u[e]=_?O[e]:I[e]:_=!0}const N=(S?h.hasInvalidWeekData(u):d?h.hasInvalidOrdinalData(u):h.hasInvalidGregorianData(u))||h.hasInvalidTimeData(u);if(N)return C.invalid(N);const k=S?h.weekToGregorian(u):d?h.ordinalToGregorian(u):u,[M,j]=D(k,s,n),A=new C({ts:M,zone:n,o:j,loc:g});return u.weekday&&T&&e.weekday!==A.weekday?C.invalid("mismatched weekday",`you can't specify both a weekday of ${u.weekday} and a date of ${A.toISO()}`):A}static fromISO(e,t={}){const[i,n]=d.parseISODate(e);return _(i,n,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[i,n]=d.parseRFC2822Date(e);return _(i,n,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[i,n]=d.parseHTTPDate(e);return _(i,n,t,"HTTP",t)}static fromFormat(e,t,i={}){if(o.isUndefined(e)||o.isUndefined(t))throw new f.InvalidArgumentError("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:r=null}=i,s=a.fromOpts({locale:n,numberingSystem:r,defaultToEN:!0}),[l,u,d,h]=c.parseFromTokens(s,e,t);return h?C.invalid(h):_(l,u,i,`format ${t}`,e,d)}static fromString(e,t,i={}){return C.fromFormat(e,t,i)}static fromSQL(e,t={}){const[i,n]=d.parseSQL(e);return _(i,n,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new f.InvalidArgumentError("need to specify a reason the DateTime is invalid");const n=e instanceof T?e:new T(e,t);if(i.throwOnInvalid)throw new f.InvalidDateTimeError(n);return new C({invalid:n})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const i=c.formatOptsToTokens(e,a.fromObject(t));return i?i.map((e=>e?e.val:null)).join(""):null}static expandFormat(e,t={}){return c.expandMacroTokens(r.parseFormat(e),a.fromObject(t)).map((e=>e.val)).join("")}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?S(this).weekYear:NaN}get weekNumber(){return this.isValid?S(this).weekNumber:NaN}get weekday(){return this.isValid?S(this).weekday:NaN}get ordinal(){return this.isValid?h.gregorianToOrdinal(this.c).ordinal:NaN}get monthShort(){return this.isValid?n.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?n.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?n.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?n.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}get isInLeapYear(){return o.isLeapYear(this.year)}get daysInMonth(){return o.daysInMonth(this.year,this.month)}get daysInYear(){return this.isValid?o.daysInYear(this.year):NaN}get weeksInWeekYear(){return this.isValid?o.weeksInWeekYear(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:i,calendar:n}=r.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:n}}toUTC(e=0,t={}){return this.setZone(s.instance(e),t)}toLocal(){return this.setZone(i.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:n=!1}={}){if((e=l.normalizeZone(e,i.defaultZone)).equals(this.zone))return this;if(e.isValid){let i=this.ts;if(t||n){const t=e.offset(this.ts),n=this.toObject();[i]=D(n,t,e)}return w(this,{ts:i,zone:e})}return C.invalid(E(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){return w(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=o.normalizeObject(e,U),i=!o.isUndefined(t.weekYear)||!o.isUndefined(t.weekNumber)||!o.isUndefined(t.weekday),n=!o.isUndefined(t.ordinal),r=!o.isUndefined(t.year),s=!o.isUndefined(t.month)||!o.isUndefined(t.day),a=r||s,l=t.weekYear||t.weekNumber;if((a||n)&&l)throw new f.ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(s&&n)throw new f.ConflictingSpecificationError("Can't mix ordinal dates with month/day");let u;i?u=h.weekToGregorian({...h.gregorianToWeek(this.c),...t}):o.isUndefined(t.ordinal)?(u={...this.toObject(),...t},o.isUndefined(t.day)&&(u.day=Math.min(o.daysInMonth(u.year,u.month),u.day))):u=h.ordinalToGregorian({...h.gregorianToOrdinal(this.c),...t});const[d,c]=D(u,this.o,this.zone);return w(this,{ts:d,o:c})}plus(t){if(!this.isValid)return this;return w(this,I(this,e.default.fromDurationLike(t)))}minus(t){if(!this.isValid)return this;return w(this,I(this,e.default.fromDurationLike(t).negate()))}startOf(t){if(!this.isValid)return this;const i={},n=e.default.normalizeUnit(t);switch(n){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0}if("weeks"===n&&(i.weekday=1),"quarters"===n){const e=Math.ceil(this.month/3);i.month=3*(e-1)+1}return this.set(i)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?r.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):y}toLocaleString(e=m.DATE_SHORT,t={}){return this.isValid?r.create(this.loc.clone(t),e).formatDateTime(this):y}toLocaleParts(e={}){return this.isValid?r.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:r=!1}={}){if(!this.isValid)return null;const s="extended"===e;let a=k(this,s);return a+="T",a+=M(this,s,t,i,n,r),a}toISODate({format:e="extended"}={}){return this.isValid?k(this,"extended"===e):null}toISOWeekDate(){return N(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:r=!1,format:s="extended"}={}){if(!this.isValid)return null;return(n?"T":"")+M(this,"extended"===s,t,e,i,r)}toRFC2822(){return N(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return N(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?k(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(t||e)&&(i&&(n+=" "),t?n+="z":e&&(n+="ZZ")),N(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():y}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",n={}){if(!this.isValid||!t.isValid)return e.default.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...n},s=o.maybeArray(i).map(e.default.normalizeUnit),a=t.valueOf()>this.valueOf(),l=u(a?this:t,a?t:this,s,r);return a?l.negate():l}diffNow(e="milliseconds",t={}){return this.diff(C.now(),e,t)}until(e){return this.isValid?t.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;const i=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(t)<=i&&i<=n.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||C.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],r=e.unit;return Array.isArray(e.unit)&&(n=e.unit,r=void 0),A(t,this.plus(i),{...e,numeric:"always",units:n,unit:r})}toRelativeCalendar(e={}){return this.isValid?A(e.base||C.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(C.isDateTime))throw new f.InvalidArgumentError("min requires all arguments be DateTimes");return o.bestBy(e,(e=>e.valueOf()),Math.min)}static max(...e){if(!e.every(C.isDateTime))throw new f.InvalidArgumentError("max requires all arguments be DateTimes");return o.bestBy(e,(e=>e.valueOf()),Math.max)}static fromFormatExplain(e,t,i={}){const{locale:n=null,numberingSystem:r=null}=i,s=a.fromOpts({locale:n,numberingSystem:r,defaultToEN:!0});return c.explainFromTokens(s,e,t)}static fromStringExplain(e,t,i={}){return C.fromFormatExplain(e,t,i)}static get DATE_SHORT(){return m.DATE_SHORT}static get DATE_MED(){return m.DATE_MED}static get DATE_MED_WITH_WEEKDAY(){return m.DATE_MED_WITH_WEEKDAY}static get DATE_FULL(){return m.DATE_FULL}static get DATE_HUGE(){return m.DATE_HUGE}static get TIME_SIMPLE(){return m.TIME_SIMPLE}static get TIME_WITH_SECONDS(){return m.TIME_WITH_SECONDS}static get TIME_WITH_SHORT_OFFSET(){return m.TIME_WITH_SHORT_OFFSET}static get TIME_WITH_LONG_OFFSET(){return m.TIME_WITH_LONG_OFFSET}static get TIME_24_SIMPLE(){return m.TIME_24_SIMPLE}static get TIME_24_WITH_SECONDS(){return m.TIME_24_WITH_SECONDS}static get TIME_24_WITH_SHORT_OFFSET(){return m.TIME_24_WITH_SHORT_OFFSET}static get TIME_24_WITH_LONG_OFFSET(){return m.TIME_24_WITH_LONG_OFFSET}static get DATETIME_SHORT(){return m.DATETIME_SHORT}static get DATETIME_SHORT_WITH_SECONDS(){return m.DATETIME_SHORT_WITH_SECONDS}static get DATETIME_MED(){return m.DATETIME_MED}static get DATETIME_MED_WITH_SECONDS(){return m.DATETIME_MED_WITH_SECONDS}static get DATETIME_MED_WITH_WEEKDAY(){return m.DATETIME_MED_WITH_WEEKDAY}static get DATETIME_FULL(){return m.DATETIME_FULL}static get DATETIME_FULL_WITH_SECONDS(){return m.DATETIME_FULL_WITH_SECONDS}static get DATETIME_HUGE(){return m.DATETIME_HUGE}static get DATETIME_HUGE_WITH_SECONDS(){return m.DATETIME_HUGE_WITH_SECONDS}}exports.default=C,exports.friendlyDateTime=function(e){if(C.isDateTime(e))return e;if(e&&e.valueOf&&o.isNumber(e.valueOf()))return C.fromJSDate(e);if(e&&"object"==typeof e)return C.fromObject(e);throw new f.InvalidArgumentError(`Unknown datetime argument: ${e}, of type ${typeof e}`)};
//# sourceMappingURL=datetime.js.map
