import t from"./duration.js";import e from"./interval.js";import i from"./settings.js";import n from"./info.js";import s from"./impl/formatter.js";import r from"./zones/fixedOffsetZone.js";import o from"./impl/locale.js";import{isUndefined as a,isDate as l,isNumber as u,normalizeObject as c,isLeapYear as h,daysInMonth as d,daysInYear as m,weeksInWeekYear as f,maybeArray as y,bestBy as w,objToLocalTS as g,padStart as T,roundTo as p}from"./impl/util.js";import{normalizeZone as O}from"./impl/zoneUtil.js";import S from"./impl/diff.js";import{parseISODate as N,parseRFC2822Date as k,parseHTTPDate as E,parseSQL as b}from"./impl/regexParser.js";import{parseFromTokens as D,formatOptsToTokens as M,expandMacroTokens as V,explainFromTokens as v}from"./impl/tokenParser.js";import{gregorianToWeek as _,gregorianToOrdinal as I,hasInvalidWeekData as z,hasInvalidOrdinalData as j,hasInvalidGregorianData as L,weekToGregorian as C,ordinalToGregorian as x,hasInvalidTimeData as F}from"./impl/conversions.js";import{DATE_SHORT as H,DATE_MED as Z,DATE_MED_WITH_WEEKDAY as U,DATE_FULL as q,DATE_HUGE as A,TIME_SIMPLE as W,TIME_WITH_SECONDS as Y,TIME_WITH_SHORT_OFFSET as $,TIME_WITH_LONG_OFFSET as R,TIME_24_SIMPLE as P,TIME_24_WITH_SECONDS as Q,TIME_24_WITH_SHORT_OFFSET as G,TIME_24_WITH_LONG_OFFSET as J,DATETIME_SHORT as K,DATETIME_SHORT_WITH_SECONDS as B,DATETIME_MED as X,DATETIME_MED_WITH_SECONDS as tt,DATETIME_MED_WITH_WEEKDAY as et,DATETIME_FULL as it,DATETIME_FULL_WITH_SECONDS as nt,DATETIME_HUGE as st,DATETIME_HUGE_WITH_SECONDS as rt}from"./impl/formats.js";import{InvalidArgumentError as ot,ConflictingSpecificationError as at,InvalidDateTimeError as lt,InvalidUnitError as ut}from"./errors.js";import ct from"./impl/invalid.js";const ht="Invalid DateTime",dt=864e13;function mt(t){return new ct("unsupported zone",`the zone "${t.name}" is not supported`)}function ft(t){return null===t.weekData&&(t.weekData=_(t.c)),t.weekData}function yt(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Lt({...i,...e,old:i})}function wt(t,e,i){let n=t-60*e*1e3;const s=i.offset(n);if(e===s)return[n,e];n-=60*(s-e)*1e3;const r=i.offset(n);return s===r?[n,s]:[t-60*Math.min(s,r)*1e3,Math.max(s,r)]}function gt(t,e){const i=new Date(t+=60*e*1e3);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function Tt(t,e,i){return wt(g(t),e,i)}function pt(e,i){const n=e.o,s=e.c.year+Math.trunc(i.years),r=e.c.month+Math.trunc(i.months)+3*Math.trunc(i.quarters),o={...e.c,year:s,month:r,day:Math.min(e.c.day,d(s,r))+Math.trunc(i.days)+7*Math.trunc(i.weeks)},a=t.fromObject({years:i.years-Math.trunc(i.years),quarters:i.quarters-Math.trunc(i.quarters),months:i.months-Math.trunc(i.months),weeks:i.weeks-Math.trunc(i.weeks),days:i.days-Math.trunc(i.days),hours:i.hours,minutes:i.minutes,seconds:i.seconds,milliseconds:i.milliseconds}).as("milliseconds"),l=g(o);let[u,c]=wt(l,n,e.zone);return 0!==a&&(u+=a,c=e.zone.offset(u)),{ts:u,o:c}}function Ot(t,e,i,n,s,r){const{setZone:o,zone:a}=i;if(t&&0!==Object.keys(t).length){const n=e||a,s=Lt.fromObject(t,{...i,zone:n,specificOffset:r});return o?s:s.setZone(a)}return Lt.invalid(new ct("unparsable",`the input "${s}" can't be parsed as ${n}`))}function St(t,e,i=!0){return t.isValid?s.create(o.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function Nt(t,e){const i=t.c.year>9999||t.c.year<0;let n="";return i&&t.c.year>=0&&(n+="+"),n+=T(t.c.year,i?6:4),e?(n+="-",n+=T(t.c.month),n+="-",n+=T(t.c.day)):(n+=T(t.c.month),n+=T(t.c.day)),n}function kt(t,e,i,n,s,r){let o=T(t.c.hour);return e?(o+=":",o+=T(t.c.minute),0===t.c.second&&i||(o+=":")):o+=T(t.c.minute),0===t.c.second&&i||(o+=T(t.c.second),0===t.c.millisecond&&n||(o+=".",o+=T(t.c.millisecond,3))),s&&(t.isOffsetFixed&&0===t.offset&&!r?o+="Z":t.o<0?(o+="-",o+=T(Math.trunc(-t.o/60)),o+=":",o+=T(Math.trunc(-t.o%60))):(o+="+",o+=T(Math.trunc(t.o/60)),o+=":",o+=T(Math.trunc(t.o%60)))),r&&(o+="["+t.zone.ianaName+"]"),o}const Et={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},bt={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Dt={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Mt=["year","month","day","hour","minute","second","millisecond"],Vt=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],vt=["year","ordinal","hour","minute","second","millisecond"];function _t(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new ut(t);return e}function It(t,e){const n=O(e.zone,i.defaultZone),s=o.fromObject(e),r=i.now();let l,u;if(a(t.year))l=r;else{for(const e of Mt)a(t[e])&&(t[e]=Et[e]);const e=L(t)||F(t);if(e)return Lt.invalid(e);const i=n.offset(r);[l,u]=Tt(t,i,n)}return new Lt({ts:l,zone:n,loc:s,o:u})}function zt(t,e,i){const n=!!a(i.round)||i.round,s=(t,s)=>{t=p(t,n||i.calendary?0:2,!0);return e.loc.clone(i).relFormatter(i).format(t,s)},r=n=>i.calendary?e.hasSame(t,n)?0:e.startOf(n).diff(t.startOf(n),n).get(n):e.diff(t,n).get(n);if(i.unit)return s(r(i.unit),i.unit);for(const t of i.units){const e=r(t);if(Math.abs(e)>=1)return s(e,t)}return s(t>e?-0:0,i.units[i.units.length-1])}function jt(t){let e,i={};return t.length>0&&"object"==typeof t[t.length-1]?(i=t[t.length-1],e=Array.from(t).slice(0,t.length-1)):e=Array.from(t),[i,e]}class Lt{constructor(t){const e=t.zone||i.defaultZone;let n=t.invalid||(Number.isNaN(t.ts)?new ct("invalid input"):null)||(e.isValid?null:mt(e));this.ts=a(t.ts)?i.now():t.ts;let s=null,r=null;if(!n){if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(e))[s,r]=[t.old.c,t.old.o];else{const t=e.offset(this.ts);s=gt(this.ts,t),n=Number.isNaN(s.year)?new ct("invalid input"):null,s=n?null:s,r=n?null:t}}this._zone=e,this.loc=t.loc||o.create(),this.invalid=n,this.weekData=null,this.c=s,this.o=r,this.isLuxonDateTime=!0}static now(){return new Lt({})}static local(){const[t,e]=jt(arguments),[i,n,s,r,o,a,l]=e;return It({year:i,month:n,day:s,hour:r,minute:o,second:a,millisecond:l},t)}static utc(){const[t,e]=jt(arguments),[i,n,s,o,a,l,u]=e;return t.zone=r.utcInstance,It({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:u},t)}static fromJSDate(t,e={}){const n=l(t)?t.valueOf():NaN;if(Number.isNaN(n))return Lt.invalid("invalid input");const s=O(e.zone,i.defaultZone);return s.isValid?new Lt({ts:n,zone:s,loc:o.fromObject(e)}):Lt.invalid(mt(s))}static fromMillis(t,e={}){if(u(t))return t<-dt||t>dt?Lt.invalid("Timestamp out of range"):new Lt({ts:t,zone:O(e.zone,i.defaultZone),loc:o.fromObject(e)});throw new ot(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,e={}){if(u(t))return new Lt({ts:1e3*t,zone:O(e.zone,i.defaultZone),loc:o.fromObject(e)});throw new ot("fromSeconds requires a numerical input")}static fromObject(t,e={}){t=t||{};const n=O(e.zone,i.defaultZone);if(!n.isValid)return Lt.invalid(mt(n));const s=i.now(),r=a(e.specificOffset)?n.offset(s):e.specificOffset,l=c(t,_t),u=!a(l.ordinal),h=!a(l.year),d=!a(l.month)||!a(l.day),m=h||d,f=l.weekYear||l.weekNumber,y=o.fromObject(e);if((m||u)&&f)throw new at("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(d&&u)throw new at("Can't mix ordinal dates with month/day");const w=f||l.weekday&&!m;let g,T,p=gt(s,r);w?(g=Vt,T=bt,p=_(p)):u?(g=vt,T=Dt,p=I(p)):(g=Mt,T=Et);let S=!1;for(const t of g){const e=l[t];a(e)?l[t]=S?T[t]:p[t]:S=!0}const N=(w?z(l):u?j(l):L(l))||F(l);if(N)return Lt.invalid(N);const k=w?C(l):u?x(l):l,[E,b]=Tt(k,r,n),D=new Lt({ts:E,zone:n,o:b,loc:y});return l.weekday&&m&&t.weekday!==D.weekday?Lt.invalid("mismatched weekday",`you can't specify both a weekday of ${l.weekday} and a date of ${D.toISO()}`):D}static fromISO(t,e={}){const[i,n]=N(t);return Ot(i,n,e,"ISO 8601",t)}static fromRFC2822(t,e={}){const[i,n]=k(t);return Ot(i,n,e,"RFC 2822",t)}static fromHTTP(t,e={}){const[i,n]=E(t);return Ot(i,n,e,"HTTP",e)}static fromFormat(t,e,i={}){if(a(t)||a(e))throw new ot("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=i,r=o.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[l,u,c,h]=D(r,t,e);return h?Lt.invalid(h):Ot(l,u,i,`format ${e}`,t,c)}static fromString(t,e,i={}){return Lt.fromFormat(t,e,i)}static fromSQL(t,e={}){const[i,n]=b(t);return Ot(i,n,e,"SQL",t)}static invalid(t,e=null){if(!t)throw new ot("need to specify a reason the DateTime is invalid");const n=t instanceof ct?t:new ct(t,e);if(i.throwOnInvalid)throw new lt(n);return new Lt({invalid:n})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,e={}){const i=M(t,o.fromObject(e));return i?i.map((t=>t?t.val:null)).join(""):null}static expandFormat(t,e={}){return V(s.parseFormat(t),o.fromObject(e)).map((t=>t.val)).join("")}get(t){return this[t]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?ft(this).weekYear:NaN}get weekNumber(){return this.isValid?ft(this).weekNumber:NaN}get weekday(){return this.isValid?ft(this).weekday:NaN}get ordinal(){return this.isValid?I(this.c).ordinal:NaN}get monthShort(){return this.isValid?n.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?n.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?n.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?n.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}get isInLeapYear(){return h(this.year)}get daysInMonth(){return d(this.year,this.month)}get daysInYear(){return this.isValid?m(this.year):NaN}get weeksInWeekYear(){return this.isValid?f(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:e,numberingSystem:i,calendar:n}=s.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:e,numberingSystem:i,outputCalendar:n}}toUTC(t=0,e={}){return this.setZone(r.instance(t),e)}toLocal(){return this.setZone(i.defaultZone)}setZone(t,{keepLocalTime:e=!1,keepCalendarTime:n=!1}={}){if((t=O(t,i.defaultZone)).equals(this.zone))return this;if(t.isValid){let i=this.ts;if(e||n){const e=t.offset(this.ts),n=this.toObject();[i]=Tt(n,e,t)}return yt(this,{ts:i,zone:t})}return Lt.invalid(mt(t))}reconfigure({locale:t,numberingSystem:e,outputCalendar:i}={}){return yt(this,{loc:this.loc.clone({locale:t,numberingSystem:e,outputCalendar:i})})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const e=c(t,_t),i=!a(e.weekYear)||!a(e.weekNumber)||!a(e.weekday),n=!a(e.ordinal),s=!a(e.year),r=!a(e.month)||!a(e.day),o=s||r,l=e.weekYear||e.weekNumber;if((o||n)&&l)throw new at("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(r&&n)throw new at("Can't mix ordinal dates with month/day");let u;i?u=C({..._(this.c),...e}):a(e.ordinal)?(u={...this.toObject(),...e},a(e.day)&&(u.day=Math.min(d(u.year,u.month),u.day))):u=x({...I(this.c),...e});const[h,m]=Tt(u,this.o,this.zone);return yt(this,{ts:h,o:m})}plus(e){if(!this.isValid)return this;return yt(this,pt(this,t.fromDurationLike(e)))}minus(e){if(!this.isValid)return this;return yt(this,pt(this,t.fromDurationLike(e).negate()))}startOf(e){if(!this.isValid)return this;const i={},n=t.normalizeUnit(e);switch(n){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0}if("weeks"===n&&(i.weekday=1),"quarters"===n){const t=Math.ceil(this.month/3);i.month=3*(t-1)+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,e={}){return this.isValid?s.create(this.loc.redefaultToEN(e)).formatDateTimeFromString(this,t):ht}toLocaleString(t=H,e={}){return this.isValid?s.create(this.loc.clone(e),t).formatDateTime(this):ht}toLocaleParts(t={}){return this.isValid?s.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:e=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const r="extended"===t;let o=Nt(this,r);return o+="T",o+=kt(this,r,e,i,n,s),o}toISODate({format:t="extended"}={}){return this.isValid?Nt(this,"extended"===t):null}toISOWeekDate(){return St(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:e=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:s=!1,format:r="extended"}={}){if(!this.isValid)return null;return(n?"T":"")+kt(this,"extended"===r,e,t,i,s)}toRFC2822(){return St(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return St(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Nt(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:e=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(e||t)&&(i&&(n+=" "),e?n+="z":t&&(n+="ZZ")),St(this,n,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():ht}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const e={...this.c};return t.includeConfig&&(e.outputCalendar=this.outputCalendar,e.numberingSystem=this.loc.numberingSystem,e.locale=this.loc.locale),e}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",n={}){if(!this.isValid||!e.isValid)return t.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...n},r=y(i).map(t.normalizeUnit),o=e.valueOf()>this.valueOf(),a=S(o?this:e,o?e:this,r,s);return o?a.negate():a}diffNow(t="milliseconds",e={}){return this.diff(Lt.now(),t,e)}until(t){return this.isValid?e.fromDateTimes(this,t):this}hasSame(t,e){if(!this.isValid)return!1;const i=t.valueOf(),n=this.setZone(t.zone,{keepLocalTime:!0});return n.startOf(e)<=i&&i<=n.endOf(e)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const e=t.base||Lt.fromObject({},{zone:this.zone}),i=t.padding?this<e?-t.padding:t.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=t.unit;return Array.isArray(t.unit)&&(n=t.unit,s=void 0),zt(e,this.plus(i),{...t,numeric:"always",units:n,unit:s})}toRelativeCalendar(t={}){return this.isValid?zt(t.base||Lt.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(Lt.isDateTime))throw new ot("min requires all arguments be DateTimes");return w(t,(t=>t.valueOf()),Math.min)}static max(...t){if(!t.every(Lt.isDateTime))throw new ot("max requires all arguments be DateTimes");return w(t,(t=>t.valueOf()),Math.max)}static fromFormatExplain(t,e,i={}){const{locale:n=null,numberingSystem:s=null}=i,r=o.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return v(r,t,e)}static fromStringExplain(t,e,i={}){return Lt.fromFormatExplain(t,e,i)}static get DATE_SHORT(){return H}static get DATE_MED(){return Z}static get DATE_MED_WITH_WEEKDAY(){return U}static get DATE_FULL(){return q}static get DATE_HUGE(){return A}static get TIME_SIMPLE(){return W}static get TIME_WITH_SECONDS(){return Y}static get TIME_WITH_SHORT_OFFSET(){return $}static get TIME_WITH_LONG_OFFSET(){return R}static get TIME_24_SIMPLE(){return P}static get TIME_24_WITH_SECONDS(){return Q}static get TIME_24_WITH_SHORT_OFFSET(){return G}static get TIME_24_WITH_LONG_OFFSET(){return J}static get DATETIME_SHORT(){return K}static get DATETIME_SHORT_WITH_SECONDS(){return B}static get DATETIME_MED(){return X}static get DATETIME_MED_WITH_SECONDS(){return tt}static get DATETIME_MED_WITH_WEEKDAY(){return et}static get DATETIME_FULL(){return it}static get DATETIME_FULL_WITH_SECONDS(){return nt}static get DATETIME_HUGE(){return st}static get DATETIME_HUGE_WITH_SECONDS(){return rt}}function Ct(t){if(Lt.isDateTime(t))return t;if(t&&t.valueOf&&u(t.valueOf()))return Lt.fromJSDate(t);if(t&&"object"==typeof t)return Lt.fromObject(t);throw new ot(`Unknown datetime argument: ${t}, of type ${typeof t}`)}export{Lt as default,Ct as friendlyDateTime};
//# sourceMappingURL=datetime.js.map
