import{roundTo as t,padStart as e,hasRelative as s}from"./util.js";import{formatRelativeTime as r,months as n,weekdays as i,meridiems as o,eras as a}from"./english.js";import l from"../settings.js";import u from"../datetime.js";import h from"../zones/IANAZone.js";let c={};let m={};function f(t,e={}){const s=JSON.stringify([t,e]);let r=m[s];return r||(r=new Intl.DateTimeFormat(t,e),m[s]=r),r}let d={};let p={};let y=null;function g(t,e,s,r,n){const i=t.listingMode(s);return"error"===i?null:"en"===i?r(e):n(e)}class C{constructor(t,e,s){this.padTo=s.padTo||0,this.floor=s.floor||!1;const{padTo:r,floor:n,...i}=s;if(!e||Object.keys(i).length>0){const e={useGrouping:!1,...s};s.padTo>0&&(e.minimumIntegerDigits=s.padTo),this.inf=function(t,e={}){const s=JSON.stringify([t,e]);let r=d[s];return r||(r=new Intl.NumberFormat(t,e),d[s]=r),r}(t,e)}}format(s){if(this.inf){const t=this.floor?Math.floor(s):s;return this.inf.format(t)}{const r=this.floor?Math.floor(s):t(s,3);return e(r,this.padTo)}}}class b{constructor(t,e,s){let r;if(this.opts=s,t.zone.isUniversal){const e=t.offset/60*-1,n=e>=0?`Etc/GMT+${e}`:`Etc/GMT${e}`;0!==t.offset&&h.create(n).valid?(r=n,this.dt=t):(r="UTC",s.timeZoneName?this.dt=t:this.dt=0===t.offset?t:u.fromMillis(t.ts+60*t.offset*1e3))}else"system"===t.zone.type?this.dt=t:(this.dt=t,r=t.zone.name);const n={...this.opts};n.timeZone=n.timeZone||r,this.dtf=f(e,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class S{constructor(t,e,r){this.opts={style:"long",...r},!e&&s()&&(this.rtf=function(t,e={}){const{base:s,...r}=e,n=JSON.stringify([t,r]);let i=p[n];return i||(i=new Intl.RelativeTimeFormat(t,e),p[n]=i),i}(t,r))}format(t,e){return this.rtf?this.rtf.format(t,e):r(e,t,this.opts.numeric,"long"!==this.opts.style)}formatToParts(t,e){return this.rtf?this.rtf.formatToParts(t,e):[]}}class T{static fromOpts(t){return T.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,e,s,r=!1){const n=t||l.defaultLocale,i=n||(r?"en-US":y||(y=(new Intl.DateTimeFormat).resolvedOptions().locale,y)),o=e||l.defaultNumberingSystem,a=s||l.defaultOutputCalendar;return new T(i,o,a,n)}static resetCache(){y=null,m={},d={},p={}}static fromObject({locale:t,numberingSystem:e,outputCalendar:s}={}){return T.create(t,e,s)}constructor(t,e,s,r){const[n,i,o]=function(t){const e=t.indexOf("-x-");-1!==e&&(t=t.substring(0,e));const s=t.indexOf("-u-");if(-1===s)return[t];{let e,r;try{e=f(t).resolvedOptions(),r=t}catch(n){const i=t.substring(0,s);e=f(i).resolvedOptions(),r=i}const{numberingSystem:n,calendar:i}=e;return[r,n,i]}}(t);this.locale=n,this.numberingSystem=e||i||null,this.outputCalendar=s||o||null,this.intl=function(t,e,s){return s||e?(t.includes("-u-")||(t+="-u"),s&&(t+=`-ca-${s}`),e&&(t+=`-nu-${e}`),t):t}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){var t;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(t=this).numberingSystem||"latn"===t.numberingSystem)&&("latn"===t.numberingSystem||!t.locale||t.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),e=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return t&&e?"en":"intl"}clone(t){return t&&0!==Object.getOwnPropertyNames(t).length?T.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1):this}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,e=!1,s=!0){return g(this,t,s,n,(()=>{const s=e?{month:t,day:"numeric"}:{month:t},r=e?"format":"standalone";return this.monthsCache[r][t]||(this.monthsCache[r][t]=function(t){const e=[];for(let s=1;s<=12;s++){const r=u.utc(2016,s,1);e.push(t(r))}return e}((t=>this.extract(t,s,"month")))),this.monthsCache[r][t]}))}weekdays(t,e=!1,s=!0){return g(this,t,s,i,(()=>{const s=e?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},r=e?"format":"standalone";return this.weekdaysCache[r][t]||(this.weekdaysCache[r][t]=function(t){const e=[];for(let s=1;s<=7;s++){const r=u.utc(2016,11,13+s);e.push(t(r))}return e}((t=>this.extract(t,s,"weekday")))),this.weekdaysCache[r][t]}))}meridiems(t=!0){return g(this,void 0,t,(()=>o),(()=>{if(!this.meridiemCache){const t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[u.utc(2016,11,13,9),u.utc(2016,11,13,19)].map((e=>this.extract(e,t,"dayperiod")))}return this.meridiemCache}))}eras(t,e=!0){return g(this,t,e,a,(()=>{const e={era:t};return this.eraCache[t]||(this.eraCache[t]=[u.utc(-40,1,1),u.utc(2017,1,1)].map((t=>this.extract(t,e,"era")))),this.eraCache[t]}))}extract(t,e,s){const r=this.dtFormatter(t,e).formatToParts().find((t=>t.type.toLowerCase()===s));return r?r.value:null}numberFormatter(t={}){return new C(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,e={}){return new b(t,this.intl,e)}relFormatter(t={}){return new S(this.intl,this.isEnglish(),t)}listFormatter(t={}){return function(t,e={}){const s=JSON.stringify([t,e]);let r=c[s];return r||(r=new Intl.ListFormat(t,e),c[s]=r),r}(this.intl,t)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}export{T as default};
//# sourceMappingURL=locale.js.map
